<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpaceSensAR ‚Äì ISS Sensory Experience Platform MVP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Cosmic Neutrals (Slate-950, Amber-400 accent) -->
    <!-- Application Structure Plan: Dashboard/Menu structure. A static header handles global navigation and settings (language, auth). The main content area dynamically switches between pages (Home, 3D Cupola View, Microgravity Sim, Education). This structure is chosen for optimal performance in a single-page app and intuitive non-linear exploration of the four main features. -->
    <!-- Visualization & Content Choices: 1. ISS Tracking -> Goal: Inform/Engage -> Viz: 3D Earth and ISS marker (Three.js Canvas) + Data Panel (HTML/JS) -> Interaction: Live update, 3D camera control (mouse drag, implemented in JS) -> Justification: Provides the core immersive experience and real-time data connection. Library: Three.js. 2. Microgravity Sim -> Goal: Train/Engage -> Viz: 3D Zero-G Environment (Three.js Canvas) + Score Tracker (HTML/JS) -> Interaction: Start/Stop button linked to mock physics and score ticks, 3D element movement. Library: Three.js. 3. Features/Education -> Goal: Organize/Inform -> Presentation: Static/Interactive cards (HTML/Tailwind) + Detail Pane (HTML/JS update). 4. Bilingual Support -> Goal: Accessibility -> Presentation: JS helper (t()) updates all strings dynamically. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #030712; /* slate-950 */
            color: #f9fafb; /* gray-50 */
        }
        .text-glow {
            text-shadow: 0 0 4px rgba(250, 204, 21, 0.5); /* amber-400 */
        }
        .canvas-container {
            position: relative;
            width: 100%;
            height: 100%;
        }
        /* Style to hide Three.js errors gracefully */
        .three-error {
            display: none; 
            color: #f87171; /* red-400 */
            padding: 1rem;
            text-align: center;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <div id="header-container"></div>

    <main id="main-content" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-10 flex-grow w-full"></main>

    <footer class="bg-slate-900 border-t border-slate-700 mt-auto">
        <div id="footer-content" class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8 text-center text-sm text-slate-500"></div>
    </footer>

    <script>
        // --- GLOBAL STATE & DATA ---
        let currentPage = 'home';
        let language = 'en';
        let isAuthenticated = false;
        const user = { name: "Pilot", id: "user-replit-42" };
        let issPosition = null;
        const ISS_API = 'https://api.wheretheiss.at/v1/satellites/25544';
        
        // Microgravity Simulation State
        let isSimRunning = false;
        let simScore = 0;
        let simInterval = null;

        // General 3D globals (shared between Cupola and Microgravity)
        let scene = null, camera = null, renderer = null; 
        let isThreeJsInitialized = false;
        let isDragging = false;
        let previousMousePosition = { x: 0, y: 0 };
        
        // Cupola specific objects
        let earthMesh = null, issMarker = null;
        const earthRotationSpeed = 0.001;
        
        // Microgravity specific objects
        let floatingObjects = [];
        const simObjectCount = 8;
        const objectDriftSpeed = 0.0005;

        const translations = {
            en: {
                title: "SpaceSensAR",
                tagline: "ISS Sensory Experience Platform",
                home: "Home",
                cupola: "Cupola View (3D)",
                microgravity: "Microgravity Sim",
                education: "ISS Education",
                login: "Log In",
                logout: "Log Out",
                welcomeMsg: (name) => `Welcome aboard, ${name}!`,
                dashboardDesc: "Access real-time data, explore 3D simulations, and track your astronaut training progress.",
                cupolaDesc: "An immersive 3D web experience: track the ISS live and view Earth from the Cupola perspective using Three.js.",
                
                // Microgravity strings
                microgravityDesc: "Practice essential skills in zero-gravity with physics-based challenges (e.g., fluid dynamics, object retrieval).",
                challengeRetrieve: "Object Retrieval Drill",
                challengeRetrieveDesc: "Navigate and collect detached equipment before it drifts away.",
                challengeFluid: "Fluid Dynamics Test",
                challengeFluidDesc: "Maneuver liquids across tanks using controlled bursts and minimal force.",
                challengeRepair: "External Truss Repair",
                challengeRepairDesc: "Use tool tethering and precise movements to secure a loose component.",
                currentScore: "Current Score",
                startChallenge: "Start Challenge",
                stopChallenge: "Stop Challenge",
                availableChallenges: "Available Challenges",
                trainingTip: "Astronaut Training Tip",
                trainingTipContent: "Momentum is conserved in microgravity! Use small, precise bursts of force to change direction.",
                simPlaceholder: "[Interactive Physics Simulation Canvas]",
                simTip: "Click 'Start Challenge' to begin training.",

                // Education strings
                educationDesc: "Learn about the vital benefits of ISS research: Climate Monitoring, Medical Advances, and Water Purification.",
                climateMonitoring: "Climate Monitoring",
                climateMonitoringDesc: "Interactive visualizations showing how ISS data contributes to climate science.",
                medicalAdvances: "Medical Advances",
                medicalAdvancesDesc: "Explaining ISS research leading to breakthroughs in health, aging, and disease treatments.",
                waterPurification: "Water Purification",
                waterPurificationDesc: "Modules detailing closed-loop life support systems and their terrestrial applications for sustainable water.",
                tapForMore: "Tap for details",
                selectModulePrompt: "Select a module above to view detailed research information.",
                climateMonitoringDetail: "The ISS provides a unique, stable platform for continuous Earth observation, monitoring global climate indicators like cloud coverage, deforestation, and polar ice melt. This data validates ground-based models and offers critical long-term insights into climate change.",
                medicalAdvancesDetail: "Studying human health in microgravity accelerates research on bone density loss, muscle atrophy, and immune system changes, mirroring challenges faced on Earth by the elderly or immobilized. Findings directly contribute to new treatments for these conditions.",
                waterPurificationDetail: "ISS life support systems recycle 98% of all water, including sweat and urine. This ultra-efficient technology is being adapted for disaster relief, remote communities, and sustainable water management on Earth, proving essential for future human survival both in space and on our planet.",

                comingSoon: "Feature development in progress...",
                currentLang: "English",
                issLat: "Latitude",
                issLon: "Longitude",
                issAlt: "Altitude (km)",
                issVel: "Velocity (km/h)",
                liveTracking: "Live ISS Position Data",
            },
            hi: {
                title: "‡§∏‡•ç‡§™‡•á‡§∏‡§∏‡•á‡§®‡•ç‡§∏‡§è‡§Ü‡§∞ (SpaceSensAR)",
                tagline: "‡§Ö‡§Ç‡§§‡§∞‡§ø‡§ï‡•ç‡§∑ ‡§∏‡•ç‡§ü‡•á‡§∂‡§® ‡§∏‡§Ç‡§µ‡•á‡§¶‡•Ä ‡§Ö‡§®‡•Å‡§≠‡§µ ‡§Æ‡§Ç‡§ö",
                home: "‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§™‡•É‡§∑‡•ç‡§†",
                cupola: "‡§ï‡§™‡•ã‡§≤‡§æ ‡§¶‡•É‡§∂‡•ç‡§Ø (3D)",
                microgravity: "‡§∏‡•Ç‡§ï‡•ç‡§∑‡•ç‡§Æ-‡§ó‡•Å‡§∞‡•Å‡§§‡•ç‡§µ‡§æ‡§ï‡§∞‡•ç‡§∑‡§£ ‡§∏‡§ø‡§Æ",
                education: "‡§Ü‡§à‡§è‡§∏‡§è‡§∏ ‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ",
                login: "‡§≤‡•â‡§ó ‡§á‡§® ‡§ï‡§∞‡•á‡§Ç",
                logout: "‡§≤‡•â‡§ó ‡§Ü‡§â‡§ü ‡§ï‡§∞‡•á‡§Ç",
                welcomeMsg: (name) => `‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à, ${name}!`,
                dashboardDesc: "‡§µ‡§æ‡§∏‡•ç‡§§‡§µ‡§ø‡§ï ‡§∏‡§Æ‡§Ø ‡§°‡•á‡§ü‡§æ ‡§è‡§ï‡•ç‡§∏‡•á‡§∏ ‡§ï‡§∞‡•á‡§Ç, 3‡§°‡•Ä ‡§∏‡§ø‡§Æ‡•Å‡§≤‡•á‡§∂‡§® ‡§ï‡§æ ‡§Ö‡§®‡•ç‡§µ‡•á‡§∑‡§£ ‡§ï‡§∞‡•á‡§Ç, ‡§î‡§∞ ‡§Ö‡§™‡§®‡•á ‡§Ö‡§Ç‡§§‡§∞‡§ø‡§ï‡•ç‡§∑ ‡§Ø‡§æ‡§§‡•ç‡§∞‡•Ä ‡§™‡•ç‡§∞‡§∂‡§ø‡§ï‡•ç‡§∑‡§£ ‡§ï‡•Ä ‡§™‡•ç‡§∞‡§ó‡§§‡§ø ‡§ü‡•ç‡§∞‡•à‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§",
                cupolaDesc: "‡§è‡§ï ‡§Ü‡§ï‡§∞‡•ç‡§∑‡§ï 3‡§°‡•Ä ‡§µ‡•á‡§¨ ‡§Ö‡§®‡•Å‡§≠‡§µ: ‡§Ü‡§à‡§è‡§∏‡§è‡§∏ ‡§ï‡•ã ‡§ü‡•ç‡§∞‡•à‡§ï ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§•‡•ç‡§∞‡•Ä.‡§ú‡•á‡§è‡§∏ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á ‡§ï‡§™‡•ã‡§≤‡§æ ‡§™‡§∞‡§ø‡§™‡•ç‡§∞‡•á‡§ï‡•ç‡§∑‡•ç‡§Ø ‡§∏‡•á ‡§™‡•É‡§•‡•ç‡§µ‡•Ä ‡§¶‡•á‡§ñ‡•á‡§Ç‡•§",
                
                // Microgravity strings
                microgravityDesc: "‡§∂‡•Ç‡§®‡•ç‡§Ø-‡§ó‡•Å‡§∞‡•Å‡§§‡•ç‡§µ‡§æ‡§ï‡§∞‡•ç‡§∑‡§£ ‡§Æ‡•á‡§Ç ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§ï‡•å‡§∂‡§≤ ‡§ï‡§æ ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç (‡§ú‡•à‡§∏‡•á ‡§¶‡•ç‡§∞‡§µ ‡§ó‡§§‡§ø‡§∂‡•Ä‡§≤‡§§‡§æ, ‡§µ‡§∏‡•ç‡§§‡•Å ‡§™‡•Å‡§®‡§∞‡•ç‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§‡§ø)‡•§",
                challengeRetrieve: "‡§µ‡§∏‡•ç‡§§‡•Å ‡§™‡•Å‡§®‡§∞‡•ç‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§‡§ø ‡§°‡•ç‡§∞‡§ø‡§≤",
                challengeRetrieveDesc: "‡§Ö‡§≤‡§ó ‡§π‡•Å‡§è ‡§â‡§™‡§ï‡§∞‡§£ ‡§ï‡•ã ‡§¨‡§π‡§®‡•á ‡§∏‡•á ‡§™‡§π‡§≤‡•á ‡§®‡•á‡§µ‡§ø‡§ó‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§á‡§ï‡§ü‡•ç‡§†‡§æ ‡§ï‡§∞‡•á‡§Ç‡•§",
                challengeFluid: "‡§¶‡•ç‡§∞‡§µ ‡§ó‡§§‡§ø‡§∂‡•Ä‡§≤‡§§‡§æ ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£",
                challengeFluidDesc: "‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§ø‡§§ ‡§´‡§ü‡§®‡•á ‡§î‡§∞ ‡§®‡•ç‡§Ø‡•Ç‡§®‡§§‡§Æ ‡§¨‡§≤ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á ‡§ü‡•à‡§Ç‡§ï‡•ã‡§Ç ‡§ï‡•á ‡§™‡§æ‡§∞ ‡§§‡§∞‡§≤ ‡§™‡§¶‡§æ‡§∞‡•ç‡§•‡•ã‡§Ç ‡§ï‡§æ ‡§™‡•à‡§Ç‡§§‡§∞‡•á‡§¨‡§æ‡§ú‡§º‡•Ä ‡§ï‡§∞‡•á‡§Ç‡•§",
                challengeRepair: "‡§¨‡§æ‡§π‡§∞‡•Ä ‡§ü‡•ç‡§∞‡§∏ ‡§Æ‡§∞‡§Æ‡•ç‡§Æ‡§§",
                challengeRepairDesc: "‡§¢‡•Ä‡§≤‡•á ‡§ò‡§ü‡§ï ‡§ï‡•ã ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§â‡§™‡§ï‡§∞‡§£ ‡§¨‡§æ‡§Ç‡§ß‡§®‡•á ‡§î‡§∞ ‡§∏‡§ü‡•Ä‡§ï ‡§ö‡§æ‡§≤‡•ã‡§Ç ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç‡•§",
                currentScore: "‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§∏‡•ç‡§ï‡•ã‡§∞",
                startChallenge: "‡§ö‡•Å‡§®‡•å‡§§‡•Ä ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç",
                stopChallenge: "‡§ö‡•Å‡§®‡•å‡§§‡•Ä ‡§∞‡•ã‡§ï‡•á‡§Ç",
                availableChallenges: "‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§ö‡•Å‡§®‡•å‡§§‡§ø‡§Ø‡§æ‡§Ç",
                trainingTip: "‡§Ö‡§Ç‡§§‡§∞‡§ø‡§ï‡•ç‡§∑ ‡§Ø‡§æ‡§§‡•ç‡§∞‡•Ä ‡§™‡•ç‡§∞‡§∂‡§ø‡§ï‡•ç‡§∑‡§£ ‡§∏‡•Å‡§ù‡§æ‡§µ",
                trainingTipContent: "‡§∏‡•Ç‡§ï‡•ç‡§∑‡•ç‡§Æ-‡§ó‡•Å‡§∞‡•Å‡§§‡•ç‡§µ‡§æ‡§ï‡§∞‡•ç‡§∑‡§£ ‡§Æ‡•á‡§Ç ‡§ó‡§§‡§ø ‡§∏‡§Ç‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§∞‡§π‡§§‡•Ä ‡§π‡•à! ‡§¶‡§ø‡§∂‡§æ ‡§¨‡§¶‡§≤‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§¨‡§≤ ‡§ï‡•á ‡§õ‡•ã‡§ü‡•á, ‡§∏‡§ü‡•Ä‡§ï ‡§´‡§ü‡§®‡•á ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç‡•§",
                simPlaceholder: "[‡§á‡§Ç‡§ü‡§∞‡•à‡§ï‡•ç‡§ü‡§ø‡§µ ‡§≠‡•å‡§§‡§ø‡§ï‡•Ä ‡§∏‡§ø‡§Æ‡•Å‡§≤‡•á‡§∂‡§® ‡§ï‡•à‡§®‡§µ‡§æ‡§∏]",
                simTip: "‡§™‡•ç‡§∞‡§∂‡§ø‡§ï‡•ç‡§∑‡§£ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è '‡§ö‡•Å‡§®‡•å‡§§‡•Ä ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç' ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§",


                // Education strings
                educationDesc: "‡§Ü‡§à‡§è‡§∏‡§è‡§∏ ‡§Ö‡§®‡•Å‡§∏‡§Ç‡§ß‡§æ‡§® ‡§ï‡•á ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§≤‡§æ‡§≠‡•ã‡§Ç ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§ú‡§æ‡§®‡•á‡§Ç: ‡§ú‡§≤‡§µ‡§æ‡§Ø‡•Å ‡§®‡§ø‡§ó‡§∞‡§æ‡§®‡•Ä, ‚Äã‚Äã‡§ö‡§ø‡§ï‡§ø‡§§‡•ç‡§∏‡§æ ‡§™‡•ç‡§∞‡§ó‡§§‡§ø, ‡§î‡§∞ ‡§ú‡§≤ ‡§∂‡•ã‡§ß‡§®‡•§",
                climateMonitoring: "‡§ú‡§≤‡§µ‡§æ‡§Ø‡•Å ‡§®‡§ø‡§ó‡§∞‡§æ‡§®‡•Ä",
                climateMonitoringDesc: "‡§á‡§Ç‡§ü‡§∞‡•à‡§ï‡•ç‡§ü‡§ø‡§µ ‡§µ‡§ø‡§ú‡§º‡•Å‡§Ö‡§≤‡§æ‡§á‡§ú‡§º‡•á‡§∂‡§® ‡§ú‡•ã ‡§¶‡§ø‡§ñ‡§æ‡§§‡•á ‡§π‡•à‡§Ç ‡§ï‡§ø ‡§Ü‡§à‡§è‡§∏‡§è‡§∏ ‡§°‡•á‡§ü‡§æ ‡§ú‡§≤‡§µ‡§æ‡§Ø‡•Å ‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§® ‡§Æ‡•á‡§Ç ‡§ï‡•à‡§∏‡•á ‡§Ø‡•ã‡§ó‡§¶‡§æ‡§® ‡§¶‡•á‡§§‡§æ ‡§π‡•à‡•§",
                medicalAdvances: "‡§ö‡§ø‡§ï‡§ø‡§§‡•ç‡§∏‡§æ ‡§™‡•ç‡§∞‡§ó‡§§‡§ø",
                medicalAdvancesDesc: "‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§î‡§∞ ‡§ú‡•Ä‡§µ ‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§® ‡§Æ‡•á‡§Ç ‡§∏‡§´‡§≤‡§§‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§ó‡•ç‡§∞‡§£‡•Ä ‡§Ü‡§à‡§è‡§∏‡§è‡§∏ ‡§Ö‡§®‡•Å‡§∏‡§Ç‡§ß‡§æ‡§® ‡§ï‡•Ä ‡§µ‡•ç‡§Ø‡§æ‡§ñ‡•ç‡§Ø‡§æ‡•§",
                waterPurification: "‡§ú‡§≤ ‡§∂‡•ã‡§ß‡§®",
                waterPurificationDesc: "‡§¨‡§Ç‡§¶-‡§≤‡•Ç‡§™ ‡§ú‡•Ä‡§µ‡§® ‡§∏‡§Æ‡§∞‡•ç‡§•‡§® ‡§™‡•ç‡§∞‡§£‡§æ‡§≤‡§ø‡§Ø‡•ã‡§Ç ‡§î‡§∞ ‡§ü‡§ø‡§ï‡§æ‡§ä ‡§™‡§æ‡§®‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§â‡§®‡§ï‡•á ‡§∏‡•ç‡§•‡§≤‡•Ä‡§Ø ‡§Ö‡§®‡•Å‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó‡•ã‡§Ç ‡§ï‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§¶‡•á‡§®‡•á ‡§µ‡§æ‡§≤‡•á ‡§Æ‡•â‡§°‡•ç‡§Ø‡•Ç‡§≤‡•§",
                tapForMore: "‡§µ‡§ø‡§µ‡§∞‡§£ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ü‡•à‡§™ ‡§ï‡§∞‡•á‡§Ç",
                selectModulePrompt: "‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§∂‡•ã‡§ß ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§¶‡•á‡§ñ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ä‡§™‡§∞ ‡§è‡§ï ‡§Æ‡•â‡§°‡•ç‡§Ø‡•Ç‡§≤ ‡§ö‡•Å‡§®‡•á‡§Ç‡•§",
                climateMonitoringDetail: "‡§Ü‡§à‡§è‡§∏‡§è‡§∏ ‡§®‡§ø‡§∞‡§Ç‡§§‡§∞ ‡§™‡•É‡§•‡•ç‡§µ‡•Ä ‡§Ö‡§µ‡§≤‡•ã‡§ï‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§Ö‡§¶‡•ç‡§µ‡§ø‡§§‡•Ä‡§Ø, ‡§∏‡•ç‡§•‡§ø‡§∞ ‡§Æ‡§Ç‡§ö ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§∞‡§§‡§æ ‡§π‡•à, ‡§ú‡•ã ‡§µ‡•à‡§∂‡•ç‡§µ‡§ø‡§ï ‡§ú‡§≤‡§µ‡§æ‡§Ø‡•Å ‡§∏‡§Ç‡§ï‡•á‡§§‡§ï‡•ã‡§Ç ‡§ú‡•à‡§∏‡•á ‡§¨‡§æ‡§¶‡§≤ ‡§ï‡§µ‡§∞‡•á‡§ú, ‡§µ‡§®‡•ã‡§Ç ‡§ï‡•Ä ‡§ï‡§ü‡§æ‡§à ‡§î‡§∞ ‡§ß‡•ç‡§∞‡•Å‡§µ‡•Ä‡§Ø ‡§¨‡§∞‡•ç‡§´ ‡§™‡§ø‡§ò‡§≤‡§®‡•á ‡§ï‡•Ä ‡§®‡§ø‡§ó‡§∞‡§æ‡§®‡•Ä ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§ ‡§Ø‡§π ‡§°‡•á‡§ü‡§æ ‡§ú‡§Æ‡•Ä‡§®-‡§Ü‡§ß‡§æ‡§∞‡§ø‡§§ ‡§Æ‡•â‡§°‡§≤‡•ã‡§Ç ‡§ï‡•ã ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§ï‡§∞‡§§‡§æ ‡§π‡•à ‡§î‡§∞ ‡§ú‡§≤‡§µ‡§æ‡§Ø‡•Å ‡§™‡§∞‡§ø‡§µ‡§∞‡•ç‡§§‡§® ‡§Æ‡•á‡§Ç ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§¶‡•Ä‡§∞‡•ç‡§ò‡§ï‡§æ‡§≤‡§ø‡§ï ‡§Ö‡§Ç‡§§‡§∞‡•ç‡§¶‡•É‡§∑‡•ç‡§ü‡§ø ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§",
                medicalAdvancesDetail: "‡§∏‡•Ç‡§ï‡•ç‡§∑‡•ç‡§Æ-‡§ó‡•Å‡§∞‡•Å‡§§‡•ç‡§µ‡§æ‡§ï‡§∞‡•ç‡§∑‡§£ ‡§Æ‡•á‡§Ç ‡§Æ‡§æ‡§®‡§µ ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§ï‡§æ ‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§® ‡§ï‡§∞‡§®‡•á ‡§∏‡•á ‡§π‡§°‡•ç‡§°‡•Ä ‡§ï‡•á ‡§ò‡§®‡§§‡•ç‡§µ ‡§ï‡•á ‡§®‡•Å‡§ï‡§∏‡§æ‡§®, ‡§Æ‡§æ‡§Ç‡§∏‡§™‡•á‡§∂‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•á ‡§∂‡•ã‡§∑ ‡§î‡§∞ ‡§™‡•ç‡§∞‡§§‡§ø‡§∞‡§ï‡•ç‡§∑‡§æ ‡§™‡•ç‡§∞‡§£‡§æ‡§≤‡•Ä ‡§Æ‡•á‡§Ç ‡§¨‡§¶‡§≤‡§æ‡§µ‡•ã‡§Ç ‡§™‡§∞ ‡§Ö‡§®‡•Å‡§∏‡§Ç‡§ß‡§æ‡§® ‡§Æ‡•á‡§Ç ‡§§‡•á‡§ú‡•Ä ‡§Ü‡§§‡•Ä ‡§π‡•à, ‡§ú‡•ã ‡§™‡•É‡§•‡•ç‡§µ‡•Ä ‡§™‡§∞ ‡§¨‡•Å‡§ú‡•Å‡§∞‡•ç‡§ó‡•ã‡§Ç ‡§Ø‡§æ ‡§∏‡•ç‡§•‡§ø‡§∞ ‡§≤‡•ã‡§ó‡•ã‡§Ç ‡§ï‡•á ‡§∏‡§æ‡§Æ‡§®‡•á ‡§Ü‡§®‡•á ‡§µ‡§æ‡§≤‡•Ä ‡§ö‡•Å‡§®‡•å‡§§‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•ã ‡§¶‡§∞‡•ç‡§∂‡§æ‡§§‡§æ ‡§π‡•à‡•§ ‡§®‡§ø‡§∑‡•ç‡§ï‡§∞‡•ç‡§∑ ‡§∏‡•Ä‡§ß‡•á ‡§á‡§® ‡§∏‡•ç‡§•‡§ø‡§§‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§®‡§è ‡§â‡§™‡§ö‡§æ‡§∞‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§Ø‡•ã‡§ó‡§¶‡§æ‡§® ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç‡•§",
                waterPurificationDetail: "‡§Ü‡§à‡§è‡§∏‡§è‡§∏ ‡§ú‡•Ä‡§µ‡§® ‡§∏‡§Æ‡§∞‡•ç‡§•‡§® ‡§™‡•ç‡§∞‡§£‡§æ‡§≤‡§ø‡§Ø‡§æ‡§Å ‡§™‡§∏‡•Ä‡§®‡•á ‡§î‡§∞ ‡§Æ‡•Ç‡§§‡•ç‡§∞ ‡§∏‡§π‡§ø‡§§ ‡§∏‡§≠‡•Ä ‡§™‡§æ‡§®‡•Ä ‡§ï‡§æ 98% ‡§™‡•Å‡§®‡§∞‡•ç‡§ö‡§ï‡•ç‡§∞‡§£ ‡§ï‡§∞‡§§‡•Ä ‡§π‡•à‡§Ç‡•§ ‡§á‡§∏ ‡§Ö‡§§‡§ø-‡§ï‡•Å‡§∂‡§≤ ‡§§‡§ï‡§®‡•Ä‡§ï ‡§ï‡•ã ‡§Ü‡§™‡§¶‡§æ ‡§∞‡§æ‡§π‡§§, ‡§¶‡•Ç‡§∞‡§¶‡§∞‡§æ‡§ú ‡§ï‡•á ‡§∏‡§Æ‡•Å‡§¶‡§æ‡§Ø‡•ã‡§Ç ‡§î‡§∞ ‡§™‡•É‡§•‡•ç‡§µ‡•Ä ‡§™‡§∞ ‡§ü‡§ø‡§ï‡§æ‡§ä ‡§ú‡§≤ ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§®‡•Å‡§ï‡•Ç‡§≤‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•à, ‡§ú‡•ã ‡§Ö‡§Ç‡§§‡§∞‡§ø‡§ï‡•ç‡§∑ ‡§î‡§∞ ‡§π‡§Æ‡§æ‡§∞‡•á ‡§ó‡•ç‡§∞‡§π ‡§¶‡•ã‡§®‡•ã‡§Ç ‡§™‡§∞ ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø ‡§Æ‡•á‡§Ç ‡§Æ‡§æ‡§®‡§µ ‡§Ö‡§∏‡•ç‡§§‡§ø‡§§‡•ç‡§µ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§∏‡§æ‡§¨‡§ø‡§§ ‡§π‡•ã‡§§‡§æ ‡§π‡•à‡•§",

                comingSoon: "Feature development in progress...",
                currentLang: "‡§π‡§ø‡§®‡•ç‡§¶‡•Ä",
                issLat: "‡§Ö‡§ï‡•ç‡§∑‡§æ‡§Ç‡§∂",
                issLon: "‡§¶‡•á‡§∂‡§æ‡§Ç‡§§‡§∞",
                issAlt: "‡§ä‡§Ç‡§ö‡§æ‡§à (‡§ï‡§ø‡§Æ‡•Ä)",
                issVel: "‡§µ‡•á‡§ó (‡§ï‡§ø‡§Æ‡•Ä/‡§ò‡§Ç‡§ü‡§æ)",
                liveTracking: "‡§≤‡§æ‡§á‡§µ ‡§Ü‡§à‡§è‡§∏‡§è‡§∏ ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§°‡•á‡§ü‡§æ",
            }
        };

        // --- CORE UTILITIES ---
        const t = (key) => translations[language][key] || key;
        const tFunc = (key, ...args) => {
            const translation = translations[language][key];
            if (typeof translation === 'function') {
                return translation(...args);
            }
            return translation || key;
        };

        const navigate = (page) => {
            if (currentPage !== page) {
                // Stop and clean up any running simulations/3D scenes
                destroyThreeJs();
                if (currentPage === 'microgravity' && isSimRunning) {
                    stopSimulation();
                }
                currentPage = page;
                renderApp();
            }
        };

        const toggleLanguage = () => {
            language = language === 'en' ? 'hi' : 'en';
            renderApp();
        };

        const handleAuth = () => {
            isAuthenticated = !isAuthenticated;
            console.log(isAuthenticated ? "Mock Login" : "Mock Logout");
            renderApp();
        };

        // --- DATA FETCHING & UPDATING ---
        const fetchIssData = async () => {
            try {
                const response = await fetch(ISS_API);
                if (!response.ok) throw new Error('ISS data fetch failed');
                const data = await response.json();
                issPosition = data;
                updateIssDataPanel();
                if (currentPage === 'cupola') {
                    updateThreeJsPosition();
                }
            } catch (e) {
                console.error("Failed to fetch ISS data:", e);
                // Fallback to mock data on failure
                if (!issPosition) {
                    issPosition = { latitude: 0, longitude: 0, altitude: 420, velocity: 7.66, timestamp: Date.now() / 1000 };
                }
            }
        };

        const updateIssDataPanel = () => {
            const panel = document.getElementById('iss-data-panel');
            if (!panel || !issPosition) return;

            panel.querySelector('#iss-lat').textContent = issPosition.latitude.toFixed(4) + '¬∞';
            panel.querySelector('#iss-lon').textContent = issPosition.longitude.toFixed(4) + '¬∞';
            panel.querySelector('#iss-alt').textContent = issPosition.altitude.toFixed(2);
            panel.querySelector('#iss-vel').textContent = (issPosition.velocity * 3600).toFixed(2);
            panel.querySelector('#iss-timestamp').textContent = new Date(issPosition.timestamp * 1000).toLocaleTimeString();
        };

        const issDataPanelHTML = () => `
            <div id="iss-data-panel" class="bg-slate-800 p-4 rounded-xl shadow-inner border border-slate-700">
                <h4 class="font-bold text-lg text-amber-400 mb-3">${t('liveTracking')}</h4>
                <div class="grid grid-cols-2 gap-4 text-sm">
                    <div class="space-y-1">
                        <p class="text-slate-400">${t('issLat')}:</p>
                        <p id="iss-lat" class="text-white font-mono text-xl">${issPosition ? issPosition.latitude.toFixed(4) : '...'}</p>
                    </div>
                    <div class="space-y-1">
                        <p class="text-slate-400">${t('issLon')}:</p>
                        <p id="iss-lon" class="text-white font-mono text-xl">${issPosition ? issPosition.longitude.toFixed(4) : '...'}</p>
                    </div>
                    <div class="space-y-1">
                        <p class="text-slate-400">${t('issAlt')}:</p>
                        <p id="iss-alt" class="text-white font-mono text-xl">${issPosition ? issPosition.altitude.toFixed(2) : '...'}</p>
                    </div>
                    <div class="space-y-1">
                        <p class="text-slate-400">${t('issVel')}:</p>
                        <p id="iss-vel" class="text-white font-mono text-xl">${issPosition ? (issPosition.velocity * 3600).toFixed(2) : '...'}</p>
                    </div>
                </div>
                <p class="text-xs text-slate-500 mt-3">Updated: <span id="iss-timestamp">${issPosition ? new Date(issPosition.timestamp * 1000).toLocaleTimeString() : '...'}</span></p>
            </div>
        `;

        // --- GENERAL THREE.JS UTILITIES ---

        function destroyThreeJs() {
            if (renderer) {
                renderer.dispose();
                const canvas = renderer.domElement;
                if (canvas && canvas.parentNode) {
                    canvas.parentNode.removeChild(canvas);
                }
            }
            scene = null;
            camera = null;
            renderer = null;
            earthMesh = null;
            issMarker = null;
            floatingObjects = [];
            isThreeJsInitialized = false;
        }
        
        // --- THREE.JS CUPOLA IMPLEMENTATION ---

        function updateThreeJsPosition() {
            if (!issPosition || !issMarker || !earthMesh) return;
            
            const radius = 1.5;
            const latRad = issPosition.latitude * (Math.PI / 180);
            const lonRad = -issPosition.longitude * (Math.PI / 180);

            const x = radius * Math.cos(latRad) * Math.sin(lonRad);
            const y = radius * Math.sin(latRad);
            const z = radius * Math.cos(latRad) * Math.cos(lonRad);

            const offset = 0.05; 
            issMarker.position.set(x * (1 + offset), y * (1 + offset), z * (1 + offset));
        }
        
        function initThreeJs(containerId) {
            if (typeof window.THREE === 'undefined') return;

            const container = document.getElementById(containerId);
            if (!container) return;

            const width = container.clientWidth;
            const height = container.clientHeight;

            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(60, width / height, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(width, height);
            
            container.appendChild(renderer.domElement);
            
            // Lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(5, 3, 5);
            scene.add(directionalLight);
            
            // Earth (Placeholder Blue sphere)
            const earthGeometry = new THREE.SphereGeometry(1.5, 64, 64);
            const earthMaterial = new THREE.MeshPhongMaterial({ color: 0x0033aa, shininess: 10, specular: 0xcccccc });
            earthMesh = new THREE.Mesh(earthGeometry, earthMaterial);
            scene.add(earthMesh);

            // ISS Marker (Yellow Box)
            const issGeometry = new THREE.BoxGeometry(0.1, 0.1, 0.1);
            const issMaterial = new THREE.MeshBasicMaterial({ color: 0xffff00 });
            issMarker = new THREE.Mesh(issGeometry, issMaterial);
            scene.add(issMarker);

            camera.position.z = 4;
            
            const animateCupola = () => {
                requestAnimationFrame(animateCupola);
                if (earthMesh) earthMesh.rotation.y += earthRotationSpeed;
                if (renderer) renderer.render(scene, camera);
            };
            animateCupola();
            
            // Mouse controls for Earth rotation
            container.addEventListener('mousedown', onMouseDown);
            window.addEventListener('mousemove', onMouseMove);
            window.addEventListener('mouseup', onMouseUp);
            window.addEventListener('resize', handleResize);
            
            updateThreeJsPosition();
            isThreeJsInitialized = true;
        }
        
        // --- THREE.JS MICROGRAVITY IMPLEMENTATION ---

        function initMicrogravitySim(containerId) {
            if (typeof window.THREE === 'undefined') return;

            const container = document.getElementById(containerId);
            if (!container) return;

            const width = container.clientWidth;
            const height = container.clientHeight;

            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x111827); // Dark interior color
            camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 100);
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: false });
            renderer.setSize(width, height);
            
            container.appendChild(renderer.domElement);
            
            // Lighting
            const light = new THREE.PointLight(0xffffff, 1, 100);
            light.position.set(0, 5, 5);
            scene.add(light);
            scene.add(new THREE.AmbientLight(0x404040));

            // Floating Equipment (Cubes)
            floatingObjects = [];
            const geometry = new THREE.BoxGeometry(0.2, 0.2, 0.2);
            for (let i = 0; i < simObjectCount; i++) {
                const material = new THREE.MeshPhongMaterial({ color: Math.random() * 0xffffff });
                const cube = new THREE.Mesh(geometry, material);
                // Random starting positions
                cube.position.set(
                    (Math.random() - 0.5) * 3,
                    (Math.random() - 0.5) * 3,
                    (Math.random() - 0.5) * 3
                );
                // Store initial velocities for drift
                cube.userData.velocity = new THREE.Vector3(
                    (Math.random() - 0.5) * objectDriftSpeed,
                    (Math.random() - 0.5) * objectDriftSpeed,
                    (Math.random() - 0.5) * objectDriftSpeed
                );
                scene.add(cube);
                floatingObjects.push(cube);
            }
            
            camera.position.z = 4;
            
            const animateMicrogravity = () => {
                requestAnimationFrame(animateMicrogravity);
                
                // Mock physics drift
                if (isSimRunning) {
                    floatingObjects.forEach(obj => {
                        obj.position.add(obj.userData.velocity);
                        obj.rotation.x += obj.userData.velocity.x * 10;
                        obj.rotation.y += obj.userData.velocity.y * 10;
                        
                        // Simple boundary detection (bounce off walls)
                        const bounds = 1.8;
                        if (Math.abs(obj.position.x) > bounds) obj.userData.velocity.x *= -1;
                        if (Math.abs(obj.position.y) > bounds) obj.userData.velocity.y *= -1;
                        if (Math.abs(obj.position.z) > bounds) obj.userData.velocity.z *= -1;
                    });
                }
                
                if (renderer) renderer.render(scene, camera);
            };
            animateMicrogravity();
            
            // Mouse controls for camera (user interaction with environment)
            container.addEventListener('mousedown', onMouseDown);
            window.addEventListener('mousemove', onMouseMove);
            window.addEventListener('mouseup', onMouseUp);
            window.addEventListener('resize', handleResize);

            isThreeJsInitialized = true;
        }

        // --- THREE.JS EVENT HANDLERS (Shared) ---
        
        const onMouseDown = (event) => {
            isDragging = true;
            previousMousePosition.x = event.clientX;
            previousMousePosition.y = event.clientY;
        };

        const onMouseMove = (event) => {
            if (!isDragging || !camera) return;
            
            const deltaX = event.clientX - previousMousePosition.x;
            const deltaY = event.clientY - previousMousePosition.y;

            const rotationSpeed = 0.005; 
            
            if (currentPage === 'cupola' && earthMesh) {
                earthMesh.rotation.y += deltaX * rotationSpeed;
                earthMesh.rotation.x += deltaY * rotationSpeed;
                earthMesh.rotation.x = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, earthMesh.rotation.x));
            } else if (currentPage === 'microgravity') {
                // Rotate the whole scene/camera perspective
                scene.rotation.y += deltaX * rotationSpeed;
                scene.rotation.x += deltaY * rotationSpeed;
            }

            previousMousePosition.x = event.clientX;
            previousMousePosition.y = event.clientY;
        };

        const onMouseUp = () => {
            isDragging = false;
        };
        
        const handleResize = () => {
            if (!camera || !renderer) return;

            const container = renderer.domElement.parentNode;
            if (!container) return;

            const newWidth = container.clientWidth;
            const newHeight = container.clientHeight;
            camera.aspect = newWidth / newHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(newWidth, newHeight);
        };

        // --- MICROGRAVITY SIMULATION LOGIC ---
        
        const updateSimScoreDisplay = () => {
            const scoreElement = document.getElementById('sim-score');
            if (scoreElement) {
                scoreElement.textContent = simScore;
            }
            const simButton = document.getElementById('sim-toggle-button');
            if (simButton) {
                simButton.textContent = isSimRunning ? t('stopChallenge') : t('startChallenge');
                simButton.className = `px-6 py-2 font-semibold rounded-full hover:shadow-lg transition shadow-md ${
                    isSimRunning ? 'bg-amber-600 text-slate-900 hover:bg-amber-700' : 'bg-red-600 text-white hover:bg-red-700'
                }`;
            }
        };

        const scoreTick = () => {
            if (isSimRunning) {
                // Mock scoring logic: score increases randomly 
                const scoreChange = Math.floor(Math.random() * 5) + 1;
                simScore += scoreChange;
                
                // Mock visual feedback: change a random object's color slightly
                if (floatingObjects.length > 0) {
                    const target = floatingObjects[Math.floor(Math.random() * floatingObjects.length)];
                    target.material.color.setHex(0x50ff50); // Flash green
                    setTimeout(() => target.material.color.setHex(Math.random() * 0xaaaaaa), 200);
                }
                
                updateSimScoreDisplay();
                
                // End condition for mock challenge
                if (simScore >= 100) {
                    stopSimulation();
                    const endMessage = document.getElementById('sim-placeholder');
                    if (endMessage) {
                        endMessage.innerHTML = `<p class="text-3xl text-green-400 font-bold">Challenge Complete!</p><p class="text-xl text-slate-300 mt-2">Final Score: ${simScore}</p>`;
                    }
                }
            }
        };

        const startSimulation = () => {
            if (isSimRunning) {
                stopSimulation();
                return;
            }
            
            // Reset for new simulation
            simScore = 0;
            isSimRunning = true;
            
            // Restore placeholder text (if challenge ended previously)
            const simTipText = `<br/><span class='text-base text-slate-500 block mt-4'>${t('simTip')}</span>`;
            const endMessage = document.getElementById('sim-placeholder');
            if (endMessage) {
                endMessage.innerHTML = `<p class="text-2xl text-red-500 font-mono text-center p-8">${t('simPlaceholder')}${simTipText}</p>`;
            }

            // Start score ticking (mock physics)
            simInterval = setInterval(scoreTick, 500);
            updateSimScoreDisplay();
        };

        const stopSimulation = () => {
            if (simInterval) {
                clearInterval(simInterval);
            }
            isSimRunning = false;
            updateSimScoreDisplay();
        };

        // --- RENDERING FUNCTIONS ---
        
        const renderHeader = () => {
            const t = (key) => translations[language][key] || key;
            const navItems = ['home', 'cupola', 'microgravity', 'education'].map(page => `
                <button
                    onclick="navigate('${page}')"
                    class="px-3 py-1 rounded-full text-sm font-medium transition duration-200 ${
                        currentPage === page
                            ? 'bg-amber-500 text-slate-900 shadow-md'
                            : 'text-gray-300 hover:bg-slate-700 hover:text-white'
                    }"
                >
                    ${t(page)}
                </button>
            `).join('');

            document.getElementById('header-container').innerHTML = `
                <header class="bg-slate-900/90 backdrop-blur-sm shadow-lg sticky top-0 z-50">
                    <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div class="flex items-center justify-between h-16">
                            <div class="flex items-center space-x-4">
                                <span class="font-extrabold text-2xl text-amber-400 tracking-wider">${t('title')}</span>
                                <span class="text-xs text-slate-500 hidden md:block">${t('tagline')}</span>
                            </div>
                            
                            <div class="flex items-center space-x-2 md:space-x-4">
                                ${navItems}
                                
                                <button
                                    onclick="toggleLanguage()"
                                    class="p-2 rounded-full text-sm font-medium bg-blue-600 text-white hover:bg-blue-700 transition"
                                    title="Switch to ${language === 'en' ? 'Hindi' : 'English'}"
                                >
                                    üåê ${language === 'en' ? 'HI' : 'EN'}
                                </button>
                                
                                <button
                                    onclick="handleAuth()"
                                    class="px-3 py-1 rounded-full text-sm font-semibold bg-red-500 text-white hover:bg-red-600 transition"
                                >
                                    ${isAuthenticated ? t('logout') : t('login')}
                                </button>
                            </div>
                        </div>
                    </nav>
                </header>
            `;
        };

        const renderCard = (title, description, icon, color, page) => `
            <button onclick="navigate('${page}')" class="flex flex-col items-center text-left p-6 rounded-xl bg-slate-800 shadow-2xl hover:shadow-xl transition transform hover:scale-[1.03] border-t-4 border-${color}-500 group">
                <div class="text-6xl mb-4 text-${color}-400 transition group-hover:animate-pulse">${icon}</div>
                <h3 class="text-xl font-bold text-white mb-2">${title}</h3>
                <p class="text-sm text-slate-400">${description}</p>
            </button>
        `;

        const renderPageHome = () => {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `
                <div class="py-12">
                    <div class="text-center mb-10">
                        <h1 class="text-4xl md:text-5xl font-extrabold text-amber-400 mb-2">${tFunc('welcomeMsg', user.name)}</h1>
                        <p class="text-lg text-slate-300">${t('dashboardDesc')}</p>
                    </div>
                    
                    <div class="grid md:grid-cols-4 gap-8 max-w-7xl mx-auto">
                        <div class="md:col-span-1">
                            ${issDataPanelHTML()}
                        </div>
                        <div class="md:col-span-3 grid grid-cols-1 sm:grid-cols-3 gap-8">
                            ${renderCard(t('cupola'), t('cupolaDesc'), "üåç", "blue", "cupola")}
                            ${renderCard(t('microgravity'), t('microgravityDesc'), "ü§∏", "red", "microgravity")}
                            ${renderCard(t('education'), t('educationDesc'), "üî¨", "green", "education")}
                        </div>
                    </div>
                </div>
            `;
        };

        const renderPageCupola = () => {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `
                <div class="py-10">
                    <h2 class="text-3xl font-bold text-white mb-4 border-b-2 border-blue-500 pb-2">${t('cupola')}</h2>
                    <p class="text-slate-400 mb-6">${t('cupolaDesc')}</p>

                    <div class="grid lg:grid-cols-4 gap-6">
                        <div class="lg:col-span-3 bg-slate-900 rounded-xl h-[70vh] flex items-center justify-center border border-blue-600 overflow-hidden relative">
                            <div id="three-container" class="canvas-container cursor-grab">
                                <div class="absolute inset-0 flex items-center justify-center text-blue-400 three-error" style="display: block;">
                                    Loading 3D Scene...
                                </div>
                            </div>
                        </div>
                        <div class="lg:col-span-1">
                            ${issDataPanelHTML()}
                        </div>
                    </div>
                </div>
            `;
            // Initialize Cupola Three.js scene
            if (typeof window.THREE !== 'undefined') initThreeJs('three-container');
        };


        const renderPageMicrogravity = () => {
            const mainContent = document.getElementById('main-content');
            
            const challengeList = [
                { name: t('challengeRetrieve'), desc: t('challengeRetrieveDesc'), icon: 'üñêÔ∏è' },
                { name: t('challengeFluid'), desc: t('challengeFluidDesc'), icon: 'üß™' },
                { name: t('challengeRepair'), desc: t('challengeRepairDesc'), icon: 'üîß' },
            ];

            const challengesHTML = challengeList.map(c => `
                <div class="bg-slate-700/50 p-4 rounded-lg flex items-center space-x-4 border border-slate-700">
                    <div class="text-3xl">${c.icon}</div>
                    <div>
                        <h4 class="font-bold text-white">${c.name}</h4>
                        <p class="text-sm text-slate-400">${c.desc}</p>
                    </div>
                </div>
            `).join('');
            
            const simTipText = `<br/><span class='text-base text-slate-500 block mt-4'>${t('simTip')}</span>`;


            mainContent.innerHTML = `
                <div class="py-10">
                    <h2 class="text-3xl font-bold text-white mb-4 border-b-2 border-red-500 pb-2">${t('microgravity')}</h2>
                    <p class="text-slate-400 mb-6">${t('microgravityDesc')}</p>
                    
                    <div class="grid lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2 bg-slate-900 rounded-xl h-[70vh] flex flex-col p-6 border border-red-600">
                            <h3 class="text-xl font-bold text-red-400 mb-4">Astronaut Training Module</h3>
                            <div class="flex-grow flex items-center justify-center overflow-hidden relative">
                                <div id="sim-canvas-container" class="canvas-container cursor-grab">
                                    <p id="sim-placeholder" class="absolute inset-0 flex items-center justify-center text-2xl text-red-500 font-mono text-center p-8 z-10 bg-slate-900/50 backdrop-blur-sm">
                                        ${t('simPlaceholder')}
                                        ${simTipText}
                                    </p>
                                </div>
                            </div>
                            <div class="flex justify-between items-center mt-4 pt-4 border-t border-slate-700">
                                <div class="text-lg">
                                    <span class="text-slate-400">${t('currentScore')}:</span> <span id="sim-score" class="font-bold text-white">${simScore}</span>
                                </div>
                                <button id="sim-toggle-button" onclick="startSimulation()" class="px-6 py-2 bg-red-600 text-white font-semibold rounded-full hover:bg-red-700 transition shadow-lg">
                                    ${t('startChallenge')}
                                </button>
                            </div>
                        </div>
                        <div class="lg:col-span-1 space-y-4">
                            <h3 class="text-xl font-bold text-white border-b border-slate-700 pb-2">${t('availableChallenges')}</h3>
                            ${challengesHTML}
                            <div class="bg-slate-800 p-4 rounded-lg text-sm text-slate-400">
                                <p class="font-bold text-amber-400">${t('trainingTip')}</p>
                                <p>${t('trainingTipContent')}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            // Initialize Microgravity Three.js scene
            if (typeof window.THREE !== 'undefined') initMicrogravitySim('sim-canvas-container');
            updateSimScoreDisplay();
        };

        // Function to update the education detail pane
        const showEducationDetail = (titleKey, detailKey) => {
            const detailElement = document.getElementById('education-detail-pane');
            if (!detailElement) return;
            
            // Get translated strings
            const title = translations[language][titleKey] || titleKey;
            const details = translations[language][detailKey] || detailKey;
            
            detailElement.innerHTML = `
                <h3 class="text-2xl font-bold text-amber-400 mb-4">${title}</h3>
                <p class="text-slate-300 mb-4 text-lg">${details}</p>
                <p class="text-xs text-slate-500">
                    ${t('comingSoon')}
                </p>
            `;
            
            detailElement.scrollIntoView({ behavior: 'smooth' });
        };


        const renderPageEducation = () => {
            const modules = [
                { titleKey: 'climateMonitoring', descKey: 'climateMonitoringDesc', icon: "üå§Ô∏è", color: "green", detailKey: 'climateMonitoringDetail' },
                { titleKey: 'medicalAdvances', descKey: 'medicalAdvancesDesc', icon: "üß¨", color: "purple", detailKey: 'medicalAdvancesDetail' },
                { titleKey: 'waterPurification', descKey: 'waterPurificationDesc', icon: "üíß", color: "teal", detailKey: 'waterPurificationDetail' },
            ];
            
            const moduleCards = modules.map((mod) => `
                <button 
                    onclick="showEducationDetail('${mod.titleKey}', '${mod.detailKey}')" 
                    class="p-6 rounded-xl bg-slate-800 shadow-xl border-l-4 border-${mod.color}-500 hover:bg-slate-700 transition text-left h-full"
                >
                    <div class="text-4xl mb-3">${mod.icon}</div>
                    <h3 class="text-xl font-bold text-white mb-2">${t(mod.titleKey)}</h3>
                    <p class="text-slate-400 text-sm">${t(mod.descKey)}</p>
                    <span class="mt-3 inline-block text-${mod.color}-300 font-semibold text-xs">${t('tapForMore')} &rarr;</span>
                </button>
            `).join('');

            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `
                <div class="py-10">
                    <h2 class="text-3xl font-bold text-white mb-4 border-b-2 border-green-500 pb-2">${t('education')}</h2>
                    <p class="text-slate-400 mb-8">${t('educationDesc')}</p>
                    
                    <div class="grid md:grid-cols-3 gap-6 mb-10">
                        ${moduleCards}
                    </div>
                    
                    <div id="education-detail-pane" class="min-h-[200px] bg-slate-800 p-8 rounded-xl border border-green-600">
                        <p class="text-center text-slate-500 text-lg">${t('selectModulePrompt')}</p>
                    </div>
                </div>
            `;
        };

        const renderFooter = () => {
            document.getElementById('footer-content').innerHTML = `
                SpaceSensAR Web MVP | Language: ${t('currentLang')} | Built for NASA Space Apps Challenge 2025
            `;
        };

        const renderApp = () => {
            if (!isAuthenticated) {
                // Simplified initial/loading screen
                document.getElementById('main-content').innerHTML = `
                    <div class="text-center py-20 text-slate-400">
                        <p class="text-2xl">${t('title')}</p>
                        <p class="mt-4">Authenticating with Replit...</p>
                    </div>
                `;
            } else {
                renderHeader();
                renderFooter();
                switch (currentPage) {
                    case 'cupola':
                        renderPageCupola();
                        break;
                    case 'microgravity':
                        renderPageMicrogravity();
                        break;
                    case 'education':
                        renderPageEducation();
                        break;
                    case 'home':
                    default:
                        renderPageHome();
                        break;
                }
            }
        };

        // --- INITIALIZATION ---
        window.onload = () => {
            // Mock Auth check
            setTimeout(() => {
                isAuthenticated = true;
                renderApp();
            }, 1000);

            // Initial data fetch and polling setup
            fetchIssData();
            setInterval(fetchIssData, 5000);
            
            // Initial render before auth completes
            renderApp();
        };

    </script>
</body>
</html>
